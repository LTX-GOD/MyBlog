<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Study K8s - Zsm Blog</title><meta name="Description" content="Zsm Blog,crypto,ctf,nodejs,wp,密码学"><meta property="og:url" content="https://www.zhuangsanmeng.xyz/study-k8s/">
  <meta property="og:site_name" content="Zsm Blog">
  <meta property="og:title" content="Study K8s">
  <meta property="og:description" content="关于安装 mac的话可以直接orb一把梭了，里面直接启动即可，如果不想的话，就直接去看官方安装方法我感觉不如orb，linux和win只能安装官方的来咯">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-09T08:58:54+08:00">
    <meta property="article:modified_time" content="2025-06-09T08:58:54+08:00">
    <meta property="article:tag" content="开发">
    <meta property="article:tag" content="Study">
    <meta property="og:image" content="https://www.zhuangsanmeng.xyz/">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.zhuangsanmeng.xyz/">
  <meta name="twitter:title" content="Study K8s">
  <meta name="twitter:description" content="关于安装 mac的话可以直接orb一把梭了，里面直接启动即可，如果不想的话，就直接去看官方安装方法我感觉不如orb，linux和win只能安装官方的来咯">
<meta name="application-name" content="Zsm blog">
<meta name="apple-mobile-web-app-title" content="Zsm blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/logo.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.zhuangsanmeng.xyz/study-k8s/" /><link rel="prev" href="https://www.zhuangsanmeng.xyz/study-docker/" /><link rel="next" href="https://www.zhuangsanmeng.xyz/yjsks/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Study K8s",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.zhuangsanmeng.xyz\/study-k8s\/"
        },"genre": "posts","keywords": "开发, study","wordcount":  4081 ,
        "url": "https:\/\/www.zhuangsanmeng.xyz\/study-k8s\/","datePublished": "2025-06-09T08:58:54+08:00","dateModified": "2025-06-09T08:58:54+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Zsm"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Zsm Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/logo.png"
        data-srcset="/images/logo.png, /images/logo.png 1.5x, /images/logo.png 2x"
        data-sizes="auto"
        alt="/images/logo.png"
        title="/images/logo.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/" title="About"> 关于 </a><a class="menu-item" href="/friend/" title="Friend"> 友链 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Zsm Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/logo.png"
        data-srcset="/images/logo.png, /images/logo.png 1.5x, /images/logo.png 2x"
        data-sizes="auto"
        alt="/images/logo.png"
        title="/images/logo.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="About">关于</a><a class="menu-item" href="/friend/" title="Friend">友链</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
    <h2 class="toc-title">Contents</h2>
    <div class="toc-content" id="toc-content-auto"></div>
</div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Study K8s</h1><div class="post-meta">
        <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Zsm</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%E5%AE%B9%E5%99%A8/"><i class="far fa-folder fa-fw"
                    aria-hidden="true"></i>容器</a></span></div>
        <div class="post-meta-line">
    

    
        

        
        
            <span id="busuanzi_container_value_page_pv"><i class="far fa-eye fa-fw"></i>
                
                <span id="busuanzi_value_page_pv"></span>&nbsp;views</span>
        
    

<i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-06-09">2025-06-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;4081 words&nbsp;
            <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;9 minutes&nbsp;<span id="/study-k8s/" class="leancloud_visitors" data-flag-title="Study K8s">
                <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span
                    class=leancloud-visitors-count></span>&nbsp;views
            </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="">
        <div class="details-summary toc-title">
            <span>Contents</span>
            <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#关于安装">关于安装</a></li>
    <li><a href="#常用命令">常用命令</a>
      <ul>
        <li><a href="#基础信息查看命令">基础信息查看命令</a></li>
        <li><a href="#pod-相关操作">Pod 相关操作</a></li>
        <li><a href="#deploymentservice-等资源操作">Deployment、Service 等资源操作</a></li>
        <li><a href="#命名空间-namespace-管理">命名空间 Namespace 管理</a></li>
        <li><a href="#配置管理configmap--secret">配置管理（ConfigMap &amp; Secret）</a></li>
        <li><a href="#资源清理与调试">资源清理与调试</a></li>
        <li><a href="#进阶命令和补充">进阶命令和补充</a></li>
      </ul>
    </li>
    <li><a href="#poddeploymentservice">Pod&amp;Deployment&amp;Service</a>
      <ul>
        <li><a href="#pod">Pod</a></li>
        <li><a href="#deployment">Deployment</a></li>
        <li><a href="#pod与deployment的关系">Pod与Deployment的关系</a></li>
        <li><a href="#service">Service</a></li>
        <li><a href="#service--pod-的关联">Service &amp; Pod 的关联</a></li>
      </ul>
    </li>
    <li><a href="#namespace">Namespace</a>
      <ul>
        <li><a href="#namespace-和哪些东西有关系">Namespace 和哪些东西有关系</a></li>
      </ul>
    </li>
    <li><a href="#configmap--secret">ConfigMap &amp; Secret</a>
      <ul>
        <li><a href="#configmap-示例">ConfigMap 示例</a></li>
        <li><a href="#secret-示例">Secret 示例</a></li>
      </ul>
    </li>
    <li><a href="#k8sdocker">k8s&amp;docker</a>
      <ul>
        <li><a href="#编年史">编年史</a></li>
        <li><a href="#如何k8sdocker">如何k8s+docker</a></li>
        <li><a href="#优点">优点</a></li>
      </ul>
    </li>
    <li><a href="#未完结">未完结</a></li>
  </ul>
</nav></div>
    </div><div class="content" id="content"><h2 id="关于安装">关于安装</h2>
<p>mac的话可以直接orb一把梭了，里面直接启动即可，如果不想的话，就直接去看<a href="https://minikube.sigs.k8s.io/docs/start/?arch=%2Flinux%2Fx86-64%2Fstable%2Fbinary&#43;download" target="_blank" rel="noopener noreffer ">官方安装方法</a>我感觉不如orb，linux和win只能安装官方的来咯</p>
<h2 id="常用命令">常用命令</h2>
<h3 id="基础信息查看命令">基础信息查看命令</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl version</code></td>
          <td>查看客户端与服务端版本信息</td>
      </tr>
      <tr>
          <td><code>kubectl cluster-info</code></td>
          <td>查看集群的基本信息（API Server、Dashboard 等）</td>
      </tr>
      <tr>
          <td><code>kubectl get nodes</code></td>
          <td>查看集群中的节点</td>
      </tr>
      <tr>
          <td><code>kubectl describe node &lt;节点名&gt;</code></td>
          <td>查看某个节点的详细信息</td>
      </tr>
      <tr>
          <td><code>kubectl get all</code></td>
          <td>查看当前命名空间下所有资源</td>
      </tr>
  </tbody>
</table>
<h3 id="pod-相关操作">Pod 相关操作</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl get pods</code></td>
          <td>查看所有 Pod</td>
      </tr>
      <tr>
          <td><code>kubectl get pods -o wide</code></td>
          <td>查看 Pod 的详细信息（包含 IP、节点）</td>
      </tr>
      <tr>
          <td><code>kubectl describe pod &lt;pod名&gt;</code></td>
          <td>查看某个 Pod 的详细信息</td>
      </tr>
      <tr>
          <td><code>kubectl logs &lt;pod名&gt;</code></td>
          <td>查看 Pod 的日志输出</td>
      </tr>
      <tr>
          <td><code>kubectl exec -it &lt;pod名&gt; -- /bin/bash</code></td>
          <td>进入容器内部（需要容器中有 bash）</td>
      </tr>
      <tr>
          <td><code>kubectl delete pod &lt;pod名&gt;</code></td>
          <td>删除指定 Pod</td>
      </tr>
  </tbody>
</table>
<h3 id="deploymentservice-等资源操作">Deployment、Service 等资源操作</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl get deployment</code></td>
          <td>查看 Deployment</td>
      </tr>
      <tr>
          <td><code>kubectl describe deployment &lt;名字&gt;</code></td>
          <td>查看 Deployment 详细信息</td>
      </tr>
      <tr>
          <td><code>kubectl apply -f &lt;yaml文件&gt;</code></td>
          <td>应用 YAML 文件，创建/更新资源</td>
      </tr>
      <tr>
          <td><code>kubectl delete -f &lt;yaml文件&gt;</code></td>
          <td>删除 YAML 文件定义的资源</td>
      </tr>
      <tr>
          <td><code>kubectl scale deployment &lt;名字&gt; --replicas=&lt;数量&gt;</code></td>
          <td>扩缩容 Deployment 的副本数</td>
      </tr>
      <tr>
          <td><code>kubectl rollout restart deployment &lt;名字&gt;</code></td>
          <td>重启 Deployment（会滚动更新 Pod）</td>
      </tr>
      <tr>
          <td><code>kubectl rollout status deployment &lt;名字&gt;</code></td>
          <td>查看 Deployment 的滚动更新状态</td>
      </tr>
      <tr>
          <td><code>kubectl expose deployment &lt;名字&gt; --type=NodePort --port=80</code></td>
          <td>暴露 Deployment 为服务</td>
      </tr>
  </tbody>
</table>
<h3 id="命名空间-namespace-管理">命名空间 Namespace 管理</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl get namespaces</code></td>
          <td>查看所有命名空间</td>
      </tr>
      <tr>
          <td><code>kubectl create namespace &lt;名称&gt;</code></td>
          <td>创建新的命名空间</td>
      </tr>
      <tr>
          <td><code>kubectl delete namespace &lt;名称&gt;</code></td>
          <td>删除命名空间</td>
      </tr>
      <tr>
          <td><code>kubectl get pods -n &lt;namespace&gt;</code></td>
          <td>查看指定命名空间下的 Pod</td>
      </tr>
      <tr>
          <td><code>kubectl config set-context --current --namespace=&lt;名称&gt;</code></td>
          <td>设置默认命名空间</td>
      </tr>
  </tbody>
</table>
<h3 id="配置管理configmap--secret">配置管理（ConfigMap &amp; Secret）</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl create configmap &lt;名称&gt; --from-literal=key=value</code></td>
          <td>创建 ConfigMap（从字面值）</td>
      </tr>
      <tr>
          <td><code>kubectl create configmap &lt;名称&gt; --from-file=&lt;文件路径&gt;</code></td>
          <td>创建 ConfigMap（从文件）</td>
      </tr>
      <tr>
          <td><code>kubectl get configmap</code></td>
          <td>查看 ConfigMap</td>
      </tr>
      <tr>
          <td><code>kubectl describe configmap &lt;名称&gt;</code></td>
          <td>查看 ConfigMap 详情</td>
      </tr>
      <tr>
          <td><code>kubectl create secret generic &lt;名称&gt; --from-literal=key=value</code></td>
          <td>创建 Secret</td>
      </tr>
      <tr>
          <td><code>kubectl get secret</code></td>
          <td>查看 Secret</td>
      </tr>
      <tr>
          <td><code>kubectl describe secret &lt;名称&gt;</code></td>
          <td>查看 Secret 详情（数据为 base64 编码）</td>
      </tr>
  </tbody>
</table>
<h3 id="资源清理与调试">资源清理与调试</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl delete pod --all</code></td>
          <td>删除当前命名空间下的所有 Pod</td>
      </tr>
      <tr>
          <td><code>kubectl get events</code></td>
          <td>查看事件日志，排查问题</td>
      </tr>
      <tr>
          <td><code>kubectl top pod</code></td>
          <td>查看 Pod 的 CPU 和内存使用情况（需要安装 Metrics Server）</td>
      </tr>
      <tr>
          <td><code>kubectl cp &lt;pod名&gt;:&lt;容器路径&gt; &lt;本地路径&gt;</code></td>
          <td>从容器中拷贝文件到本地</td>
      </tr>
      <tr>
          <td><code>kubectl debug &lt;pod名&gt;</code></td>
          <td>使用临时容器调试（1.18+ 版本支持）</td>
      </tr>
  </tbody>
</table>
<h3 id="进阶命令和补充">进阶命令和补充</h3>
<table>
  <thead>
      <tr>
          <th>命令</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>kubectl edit &lt;资源类型&gt; &lt;名称&gt;</code></td>
          <td>使用编辑器修改资源定义</td>
      </tr>
      <tr>
          <td><code>kubectl explain &lt;资源&gt;</code></td>
          <td>查看资源字段的文档说明</td>
      </tr>
      <tr>
          <td><code>kubectl api-resources</code></td>
          <td>查看集群支持的 API 资源类型</td>
      </tr>
      <tr>
          <td><code>kubectl get &lt;资源&gt; -A</code></td>
          <td>查看所有命名空间的资源（如 <code>-A</code> 表示 all namespaces）</td>
      </tr>
  </tbody>
</table>
<h2 id="poddeploymentservice">Pod&amp;Deployment&amp;Service</h2>
<h3 id="pod">Pod</h3>
<p>是Kubernetes中最小的可调度单元，表示运行中的的一个or多个容器，比如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get pods                                      
</span></span><span class="line"><span class="cl">NAME                                  READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">redis-c479dfb5-wcj8g                  1/1     Running   0          45h
</span></span><span class="line"><span class="cl">yunjisuan-backend-5fbbd85dd8-kkqq7    1/1     Running   0          43h
</span></span><span class="line"><span class="cl">yunjisuan-frontend-56fd559cbd-gjf2b   1/1     Running   0          43h
</span></span></code></pre></td></tr></table>
</div>
</div><p>我的视角里把他当作一个容器的载体，一般是一对一的关系，而且当这个pod挂掉了，他是不会自动重建的，需要用<code>Deployment</code>去启动，这也是为什么官方不会让你直接创建pod的原因？</p>
<h3 id="deployment">Deployment</h3>
<p>是一种控制器，用于管理 Pod 的副本、副本数量、升级、回滚等，比如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">kubectl get deployments    
</span></span><span class="line"><span class="cl">NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">redis                1/1     1            1           45h
</span></span><span class="line"><span class="cl">yunjisuan-backend    1/1     1            1           43h
</span></span><span class="line"><span class="cl">yunjisuan-frontend   1/1     1            1           43h
</span></span></code></pre></td></tr></table>
</div>
</div><p>在我视角里他是pod的管理者，并且可以自动重新创建运行失败的pod，具备高可用和可扩展性。Deployment 就像是 Pod 的调度与生命周期控制器</p>
<h3 id="pod与deployment的关系">Pod与Deployment的关系</h3>
<p>可能会注意到</p>
<blockquote>
<p>kubectl get deployments <br>
kubectl get pods</p></blockquote>
<p>这两条指令的输出内容是差不多的，为什么呢？<br>
看一个层级结构图吧</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Deployment
</span></span><span class="line"><span class="cl">   └── ReplicaSet（自动管理）
</span></span><span class="line"><span class="cl">         └── Pod（实际运行）
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Deployment 是“宣言式配置”：你说我需要 1 个 nginx 服务，它就帮你创建和维持它。</li>
<li>ReplicaSet 是由 Deployment 自动创建的副本控制器，不需要你关心。</li>
<li>Pod 是最终由 ReplicaSet 实际运行的容器单元。</li>
</ul>
<p>那我目前在一个Deployment下只创建了一个pod，<code>kubectl get deployments</code>显示的是部署情况，<code>kubectl get pods</code>显示的是真实运行的容器实例，所以相似是合理的，并且可以发现，pod在创建时会自动加上一个随机字符串的后缀</p>
<h3 id="service">Service</h3>
<p>Pod 是会消失和变化的（比如被重新调度、重启等），而它们的 IP 地址也是 不固定的。</p>
<p>所以为了让外部访问、或内部服务间通信能找到 Pod、负载均衡、自动发现，就需要一个“中间层”来负责这个事，那就是：service</p>
<p><strong>为什么需要 Service？</strong></p>
<table>
  <thead>
      <tr>
          <th>问题</th>
          <th>Service 怎么解决</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Pod 的 IP 不稳定？</td>
          <td>Service 提供一个固定 IP 和 DNS 名字</td>
      </tr>
      <tr>
          <td>有多个 Pod（副本）？</td>
          <td>Service 自动做负载均衡</td>
      </tr>
      <tr>
          <td>不同命名空间、服务间需要通信？</td>
          <td>Service 让通信变得可控和可配置</td>
      </tr>
      <tr>
          <td>想暴露服务到集群外部？</td>
          <td>Service 可以暴露端口给外部访问</td>
      </tr>
  </tbody>
</table>
<p><strong>Service 的类型</strong></p>
<table>
  <thead>
      <tr>
          <th>类型</th>
          <th>说明</th>
          <th>用途</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>ClusterIP</code>（默认）</td>
          <td>只在集群内部可访问</td>
          <td>后端服务通信（比如：前端调后端）</td>
      </tr>
      <tr>
          <td><code>NodePort</code></td>
          <td>绑定每个 Node 的某个端口，对外暴露</td>
          <td>外部访问集群中服务</td>
      </tr>
      <tr>
          <td><code>LoadBalancer</code></td>
          <td>由云服务商分配一个负载均衡器 IP</td>
          <td>生产环境常用，适合云平台</td>
      </tr>
      <tr>
          <td><code>ExternalName</code></td>
          <td>映射到外部 DNS 名称</td>
          <td>访问外部服务（如数据库）</td>
      </tr>
  </tbody>
</table>
<p>一般部署是通过编辑文件实现效果<br>
假设有个 Deployment</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>我们为它创建一个 Service去ClusterIP：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">           </span><span class="c"># Service 暴露的端口</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">   </span><span class="c"># 容器实际监听的端口</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>其他的pod就可以通过<code>http://my-backend-service:80</code>访问</p>
<h3 id="service--pod-的关联">Service &amp; Pod 的关联</h3>
<p>Kubernetes 中的 Pod 会带有 labels（标签），而 Service 会通过 selector（选择器）来选中这些 Pod，两者通过这个机制产生关联，比如pod的定义如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>你就可以看见<code>labels</code>的内容是<code>app</code>和<code>tier</code>，然后我们定义一个 Service</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>selector</code>里面指向这个<code>app</code>，这个server就会找到所有含这个标签的pod，并且添加到Endpoints(负载池)里面。<br>
示意图</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[ Service ]
</span></span><span class="line"><span class="cl">   |
</span></span><span class="line"><span class="cl">   └── selector: app=xxx
</span></span><span class="line"><span class="cl">         ↓（匹配标签）
</span></span><span class="line"><span class="cl">   ┌───────────────┐
</span></span><span class="line"><span class="cl">   │    Pod 1      │ ← labels: app=xxx
</span></span><span class="line"><span class="cl">   ├───────────────┤
</span></span><span class="line"><span class="cl">   │    Pod 2      │ ← labels: app=xxx
</span></span><span class="line"><span class="cl">   └───────────────┘
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service 自动负载均衡访问这两个 Pod！
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="namespace">Namespace</h2>
<p>Namespace 是 Kubernetes 的逻辑隔离机制，可以把同一个集群划分成多个“虚拟子集群”。就像是在一个东西里面又分了好几块，互不影响，各自管理。</p>
<h3 id="namespace-和哪些东西有关系">Namespace 和哪些东西有关系</h3>
<p><strong>资源对象的作用域</strong></p>
<table>
  <thead>
      <tr>
          <th>属于 Namespace 的资源</th>
          <th>示例</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Pod / Deployment / StatefulSet / Job</td>
          <td>运行的工作负载</td>
      </tr>
      <tr>
          <td>Service / Ingress</td>
          <td>服务暴露方式</td>
      </tr>
      <tr>
          <td>ConfigMap / Secret</td>
          <td>配置和敏感数据</td>
      </tr>
      <tr>
          <td>PVC（PersistentVolumeClaim）</td>
          <td>存储请求</td>
      </tr>
      <tr>
          <td>ServiceAccount / Role / RoleBinding</td>
          <td>权限控制</td>
      </tr>
  </tbody>
</table>
<p><strong>访问权限控制</strong>
比如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Role</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;pods&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;list&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;create&#34;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>配合 RoleBinding(绑定用户用的)，就可以让某个用户只能操作 dev 命名空间里的 Pod</p>
<p><strong>资源配额限制</strong>
Kubernetes 支持对每个命名空间限制 CPU、内存、Pod 数量等资源，防止“某一方霸占资源”。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ResourceQuota</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mem-cpu-limit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests.cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests.memory</span><span class="p">:</span><span class="w"> </span><span class="l">4Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">limits.cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">limits.memory</span><span class="p">:</span><span class="w"> </span><span class="l">8Gi</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这样去设置上限</p>
<p><strong>名字隔离</strong>
同一个名字在不同的命名空间内是可以重复的</p>
<blockquote>
<p>kubectl get pods -n dev
kubectl get pods -n prod</p></blockquote>
<p><strong>DNS 服务发现</strong>
同名服务在不同命名空间中是不会冲突的
比如<code>http://my-service.default.svc.cluster.local</code>的完整格式是<code>&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</code></p>
<h2 id="configmap--secret">ConfigMap &amp; Secret</h2>
<table>
  <thead>
      <tr>
          <th>名称</th>
          <th>作用</th>
          <th>内容类型</th>
          <th>存储方式</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>ConfigMap</strong></td>
          <td>存储<strong>非敏感配置</strong>（如环境变量、配置文件）</td>
          <td>普通明文</td>
          <td>Base64 编码但不加密</td>
      </tr>
      <tr>
          <td><strong>Secret</strong></td>
          <td>存储<strong>敏感信息</strong>（如密码、Token、证书）</td>
          <td>加密/编码内容</td>
          <td>默认 Base64，可配合密钥管理器加密存储</td>
      </tr>
  </tbody>
</table>
<h3 id="configmap-示例">ConfigMap 示例</h3>
<p>先创建一个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">APP_NAME</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;MyApp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;dev&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">CONFIG_JSON</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    {
</span></span></span><span class="line"><span class="cl"><span class="sd">      &#34;logLevel&#34;: &#34;debug&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">      &#34;maxConn&#34;: 100
</span></span></span><span class="line"><span class="cl"><span class="sd">    }</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在pod中作为环境变量使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">APP_NAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">APP_NAME</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在pod中挂载为文件使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">APP_NAME</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">APP_NAME</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="secret-示例">Secret 示例</h3>
<p>先创建一个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Opaque</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">bXlwYXNzd29yZA==</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>作为环境变量使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">DB_PASSWORD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">DB_PASSWORD</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>挂载为文件使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">secret-vol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">my-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">secret-vol</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/secret&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="k8sdocker">k8s&amp;docker</h2>
<h3 id="编年史">编年史</h3>
<p>在很久很久以前(v1.3 ～ v1.19)，k8s默认启动pod是docker，v1.20开始宣布弃用 Dockershim，v1.24正式弃用Dockershim<br>
可以认为以前的pod启动顺序是</p>
<blockquote>
<p>kubectl → kubelet → Dockershim → Docker → 容器</p></blockquote>
<p>后面k8s感觉还是太重了，就干脆只用自己的<code>containerd</code>了</p>
<h3 id="如何k8sdocker">如何k8s+docker</h3>
<p>假如我现在有一个写好的三端项目，后端/前端/小程序，我分别包了一个docker去运行，我现在有需求去多节点分布式部署，该怎么办呢？<br>
答案很简单：k8s里面跑docker(这样我写的dockerfile也不会浪费)</p>
<p>如何实现这种操作呢？</p>
<p>首先你要知道，docker里面也有<code>containerd</code>，哎，那实际上原理相同，我让k8s的<code>containerd</code>去跑docker镜像的内容进行了，如图所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[ 开发者 ]
</span></span><span class="line"><span class="cl">    ↓ docker build
</span></span><span class="line"><span class="cl">[ 本地镜像 ]
</span></span><span class="line"><span class="cl">    ↓ docker push
</span></span><span class="line"><span class="cl">[ 镜像仓库（如 Harbor / Docker Hub） ]
</span></span><span class="line"><span class="cl">    ↓ kubectl apply
</span></span><span class="line"><span class="cl">[ K8s 控制器 ]
</span></span><span class="line"><span class="cl">    ↓ 调度到 Node
</span></span><span class="line"><span class="cl">[ kubelet ]
</span></span><span class="line"><span class="cl">    ↓ container runtime（Containerd）
</span></span><span class="line"><span class="cl">[ Pod 中容器运行 ]
</span></span></code></pre></td></tr></table>
</div>
</div><p>而去调用docker就要依赖<code>.yaml</code>文件的编写了，如</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker build -t myapp:v1 .
</span></span><span class="line"><span class="cl">docker tag myapp:v1 registry.example.com/myapp:v1
</span></span><span class="line"><span class="cl">docker push registry.example.com/myapp:v1
</span></span></code></pre></td></tr></table>
</div>
</div><p>我这个时候要在pod里面引用这个镜像</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">registry.example.com/myapp:v1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>然后只要指令部署即可了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f myapp-deployment.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="优点">优点</h3>
<p><strong>作用方面</strong>
首先docker和k8s在一定程度上的任务是不同的</p>
<table>
  <thead>
      <tr>
          <th>工具</th>
          <th>主要职责</th>
          <th>类似比喻</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Docker</strong></td>
          <td>用来<strong>构建镜像</strong>，本地运行测试容器</td>
          <td>工厂生产产品</td>
      </tr>
      <tr>
          <td><strong>Kubernetes</strong></td>
          <td>管理和编排容器，自动部署、扩缩容、服务发现等</td>
          <td>仓库 + 快递调度系统</td>
      </tr>
  </tbody>
</table>
<p><strong>开发/部署/运维方面</strong>
我在本地进行项目开发，完成后构建docker，然后推送镜像，云端只需要写个<code>.yaml</code>文件就可以部署了，你说爽不爽。并且这样开发只用在意docker，运维之用在意k8s，各司其职</p>
<p><strong>自动化</strong>
可以实现自动化推送部署更新</p>
<blockquote>
<p>开发提交代码 → 自动构建 Docker 镜像 → 自动推送 → K8s 自动更新部署</p></blockquote>
<h2 id="未完结">未完结</h2>
<p>咕咕咕</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2025-06-09</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/study-k8s/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://www.zhuangsanmeng.xyz/study-k8s/" data-title="Study K8s" data-hashtags="开发,study"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://www.zhuangsanmeng.xyz/study-k8s/" data-hashtag="开发"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://www.zhuangsanmeng.xyz/study-k8s/" data-title="Study K8s"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://www.zhuangsanmeng.xyz/study-k8s/" data-title="Study K8s"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://www.zhuangsanmeng.xyz/study-k8s/" data-title="Study K8s"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E5%BC%80%E5%8F%91/">开发</a>,&nbsp;<a href="/tags/study/">Study</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/study-docker/" class="prev" rel="prev" title="Study Docker"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Study Docker</a>
            <a href="/yjsks/" class="next" rel="next" title="云计算课设">云计算课设<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src=''></script>

    <script type="text/javascript">
        new Valine({
            el: '#valine',
            appId: 'XiJ1G58psCdX6BgfE27O7IH9-MdYXbMMI',
            appKey: 'e9j5fWZui0l2YfNwupu7SDW2',
            notify: '',
            verify: '',
            avatar: 'mp',
            placeholder: '留下你的评论～',
            visitor: 'true'
        });
    </script></div></article></div>
            </main><footer class="footer">
    <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer"
                title="Hugo 0.147.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank"
                rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw"
                    aria-hidden="true"></i> LoveIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a
                    href="/" target="_blank">Zsm</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br" />
            <span class="icp">豫ICP备2024048128号</span></div>
    
        
        <script async src=" //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js "></script>
    

    
        
            <section>
                
                    <span id="busuanzi_container_value_site_pv"><i class="far fa-eye fa-fw"></i>
                        
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                

                
                    &nbsp;|&nbsp;              
                

                
                    <span id="busuanzi_container_value_site_uv"><i class="fa fa-user"></i>
                        
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
            </section>
        

        
        
    

</div>
</footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
