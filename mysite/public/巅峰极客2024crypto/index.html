<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>巅峰极客2024_crypto - Zsm Blog</title><meta name="Description" content="Zsm Blog,crypto,ctf,nodejs,wp,密码学"><meta property="og:url" content="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/">
  <meta property="og:site_name" content="Zsm Blog">
  <meta property="og:title" content="巅峰极客2024_crypto">
  <meta property="og:description" content="前言 应该是这个暑假里面(目前)打的最难的一场了，相比于das，他就上一个密码题啊我靠，八个小时，上了三波题，就开局一个密码，还是没写过的ECDSA加密，写不出来就很尴尬也很痛苦 题目 task 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 from ecdsa.ecdsa import * from Crypto.Util.number import * import hashlib import gmpy2 def inverse_mod(a, m): if a == 0: return 0 return gmpy2.powmod(a, -1, m) def bit_length(x): return x.bit_length() def get_malicious_key(): a = 751818 b = 1155982 w = 908970521 X = 20391992 return a, b, w, X class RSZeroError(RuntimeError): pass class InvalidPointError(RuntimeError): pass class Signature(object): &#34;&#34;&#34;ECDSA signature.&#34;&#34;&#34; def __init__(self, r, s): self.r = r self.s = s class Public_key(object): &#34;&#34;&#34;Public key for ECDSA.&#34;&#34;&#34; def __init__(self, generator, point, verify=True): self.curve = generator.curve() self.generator = generator self.point = point n = generator.order() p = self.curve.p() if not (0 &lt;= point.x() &lt; p) or not (0 &lt;= point.y() &lt; p): raise InvalidPointError( &#34;The public point has x or y out of range.&#34; ) if verify and not self.curve.contains_point(point.x(), point.y()): raise InvalidPointError(&#34;Point does not lay on the curve&#34;) if not n: raise InvalidPointError(&#34;Generator point must have order.&#34;) if ( verify and self.curve.cofactor() != 1 and not n * point == ellipticcurve.INFINITY ): raise InvalidPointError(&#34;Generator point order is bad.&#34;) class Private_key(object): &#34;&#34;&#34;Private key for ECDSA.&#34;&#34;&#34; def __init__(self, public_key, secret_multiplier): self.public_key = public_key self.secret_multiplier = secret_multiplier def sign(self, hash, random_k): G = self.public_key.generator n = G.order()# 获取该椭圆模数 k = random_k % n p1 = k * G r = p1.x() % n if r == 0: raise RSZeroError(&#34;amazingly unlucky random number r&#34;) s = ( inverse_mod(k, n) * (hash &#43; (self.secret_multiplier * r) % n) ) % n if s == 0: raise RSZeroError(&#34;amazingly unlucky random number s&#34;) return Signature(r, s) def malicious_sign(self,hash, random_k, a, b, w, X): # t = random.randint(0,1) t = 1 G = self.public_key.generator Y = X * G n = G.order() k1 = random_k z = (k1 - w * t) * G &#43; (-a * k1 - b) * Y zx = z.x() % n k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16) #print(f&#39;k2 = {k2}&#39;) p1 = k2 * G r = p1.x() % n if r == 0: raise RSZeroError(&#34;amazingly unlucky random number r&#34;) s = ( inverse_mod(k2, n) * (hash &#43; (self.secret_multiplier * r) % n) ) % n if s == 0: raise RSZeroError(&#34;amazingly unlucky random number s&#34;) return (Signature(r, s),k2) if __name__ == &#39;__main__&#39;: a,b,w,X = get_malicious_key() message1 = b&#39;It sounds as though you were lamenting,&#39; message2 = b&#39;a butterfly cooing like a dove.&#39; hash_message1 = int(hashlib.sha1(message1).hexdigest(), 16) hash_message2 = int(hashlib.sha1(message2).hexdigest(), 16) private = getRandomNBitInteger(50) rand = getRandomNBitInteger(49) public_key = Public_key(generator_192, generator_192 * private) private_key = Private_key(public_key, private) sig = private_key.sign(hash_message1, rand) malicious_sig,k2 = private_key.malicious_sign(hash_message2, rand, a,b,w,X) print(a,b,w,X) print(sig.r) print(malicious_sig.r) &#39;&#39;&#39; 751818 1155982 908970521 20391992 sig.r=6052579169727414254054653383715281797417510994285530927615 malicious_sig.r=3839784391338849056467977882403235863760503590134852141664 &#39;&#39;&#39; # flag为flag{uuid}格式 flag = b&#39;&#39; m = bytes_to_long(flag) p = k2 for i in range(99): p = gmpy2.next_prime(p) q = gmpy2.next_prime(p) e = 65537 c = pow(m,e,p*q) print(c) # 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943 写题的时候有一些地方被我改了一点点，应该可以看出来（）">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-12T00:00:00+00:00">
    <meta property="article:tag" content="Crypto">
    <meta property="og:image" content="https://www.zhuangsanmeng.xyz/">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.zhuangsanmeng.xyz/">
  <meta name="twitter:title" content="巅峰极客2024_crypto">
  <meta name="twitter:description" content="前言 应该是这个暑假里面(目前)打的最难的一场了，相比于das，他就上一个密码题啊我靠，八个小时，上了三波题，就开局一个密码，还是没写过的ECDSA加密，写不出来就很尴尬也很痛苦 题目 task 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 from ecdsa.ecdsa import * from Crypto.Util.number import * import hashlib import gmpy2 def inverse_mod(a, m): if a == 0: return 0 return gmpy2.powmod(a, -1, m) def bit_length(x): return x.bit_length() def get_malicious_key(): a = 751818 b = 1155982 w = 908970521 X = 20391992 return a, b, w, X class RSZeroError(RuntimeError): pass class InvalidPointError(RuntimeError): pass class Signature(object): &#34;&#34;&#34;ECDSA signature.&#34;&#34;&#34; def __init__(self, r, s): self.r = r self.s = s class Public_key(object): &#34;&#34;&#34;Public key for ECDSA.&#34;&#34;&#34; def __init__(self, generator, point, verify=True): self.curve = generator.curve() self.generator = generator self.point = point n = generator.order() p = self.curve.p() if not (0 &lt;= point.x() &lt; p) or not (0 &lt;= point.y() &lt; p): raise InvalidPointError( &#34;The public point has x or y out of range.&#34; ) if verify and not self.curve.contains_point(point.x(), point.y()): raise InvalidPointError(&#34;Point does not lay on the curve&#34;) if not n: raise InvalidPointError(&#34;Generator point must have order.&#34;) if ( verify and self.curve.cofactor() != 1 and not n * point == ellipticcurve.INFINITY ): raise InvalidPointError(&#34;Generator point order is bad.&#34;) class Private_key(object): &#34;&#34;&#34;Private key for ECDSA.&#34;&#34;&#34; def __init__(self, public_key, secret_multiplier): self.public_key = public_key self.secret_multiplier = secret_multiplier def sign(self, hash, random_k): G = self.public_key.generator n = G.order()# 获取该椭圆模数 k = random_k % n p1 = k * G r = p1.x() % n if r == 0: raise RSZeroError(&#34;amazingly unlucky random number r&#34;) s = ( inverse_mod(k, n) * (hash &#43; (self.secret_multiplier * r) % n) ) % n if s == 0: raise RSZeroError(&#34;amazingly unlucky random number s&#34;) return Signature(r, s) def malicious_sign(self,hash, random_k, a, b, w, X): # t = random.randint(0,1) t = 1 G = self.public_key.generator Y = X * G n = G.order() k1 = random_k z = (k1 - w * t) * G &#43; (-a * k1 - b) * Y zx = z.x() % n k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16) #print(f&#39;k2 = {k2}&#39;) p1 = k2 * G r = p1.x() % n if r == 0: raise RSZeroError(&#34;amazingly unlucky random number r&#34;) s = ( inverse_mod(k2, n) * (hash &#43; (self.secret_multiplier * r) % n) ) % n if s == 0: raise RSZeroError(&#34;amazingly unlucky random number s&#34;) return (Signature(r, s),k2) if __name__ == &#39;__main__&#39;: a,b,w,X = get_malicious_key() message1 = b&#39;It sounds as though you were lamenting,&#39; message2 = b&#39;a butterfly cooing like a dove.&#39; hash_message1 = int(hashlib.sha1(message1).hexdigest(), 16) hash_message2 = int(hashlib.sha1(message2).hexdigest(), 16) private = getRandomNBitInteger(50) rand = getRandomNBitInteger(49) public_key = Public_key(generator_192, generator_192 * private) private_key = Private_key(public_key, private) sig = private_key.sign(hash_message1, rand) malicious_sig,k2 = private_key.malicious_sign(hash_message2, rand, a,b,w,X) print(a,b,w,X) print(sig.r) print(malicious_sig.r) &#39;&#39;&#39; 751818 1155982 908970521 20391992 sig.r=6052579169727414254054653383715281797417510994285530927615 malicious_sig.r=3839784391338849056467977882403235863760503590134852141664 &#39;&#39;&#39; # flag为flag{uuid}格式 flag = b&#39;&#39; m = bytes_to_long(flag) p = k2 for i in range(99): p = gmpy2.next_prime(p) q = gmpy2.next_prime(p) e = 65537 c = pow(m,e,p*q) print(c) # 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943 写题的时候有一些地方被我改了一点点，应该可以看出来（）">
<meta name="application-name" content="Zsm blog">
<meta name="apple-mobile-web-app-title" content="Zsm blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/logo.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" /><link rel="prev" href="https://www.zhuangsanmeng.xyz/%E5%BC%BA%E7%BD%91%E6%9D%AF2024_crypto/" /><link rel="next" href="https://www.zhuangsanmeng.xyz/%E5%9B%BD%E5%9F%8E%E6%9D%AF2024_crypto/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "巅峰极客2024_crypto",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.zhuangsanmeng.xyz\/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto\/"
        },"genre": "posts","keywords": "crypto","wordcount":  1762 ,
        "url": "https:\/\/www.zhuangsanmeng.xyz\/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto\/","datePublished": "2024-12-12T00:00:00+00:00","dateModified": "2024-12-12T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Zsm"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Zsm Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/logo.png"
        data-srcset="/images/logo.png, /images/logo.png 1.5x, /images/logo.png 2x"
        data-sizes="auto"
        alt="/images/logo.png"
        title="/images/logo.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/" title="About"> 关于 </a><a class="menu-item" href="/friend/" title="Friend"> 友链 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Zsm Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/logo.png"
        data-srcset="/images/logo.png, /images/logo.png 1.5x, /images/logo.png 2x"
        data-sizes="auto"
        alt="/images/logo.png"
        title="/images/logo.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="About">关于</a><a class="menu-item" href="/friend/" title="Friend">友链</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
    <h2 class="toc-title">Contents</h2>
    <div class="toc-content" id="toc-content-auto"></div>
</div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">巅峰极客2024_crypto</h1><div class="post-meta">
        <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Zsm</a></span>&nbsp;<span class="post-category">included in <a href="/categories/ctf/"><i class="far fa-folder fa-fw"
                    aria-hidden="true"></i>CTF</a></span></div>
        <div class="post-meta-line">
    

    
        

        
        
            <span id="busuanzi_container_value_page_pv"><i class="far fa-eye fa-fw"></i>
                
                <span id="busuanzi_value_page_pv"></span>&nbsp;views</span>
        
    

<i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-12-12">2024-12-12</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1762 words&nbsp;
            <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;4 minutes&nbsp;<span id="/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" class="leancloud_visitors" data-flag-title="巅峰极客2024_crypto">
                <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span
                    class=leancloud-visitors-count></span>&nbsp;views
            </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="">
        <div class="details-summary toc-title">
            <span>Contents</span>
            <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents"></nav></div>
    </div><div class="content" id="content"><h2>
前言
</h2>
应该是这个暑假里面(目前)打的最难的一场了，相比于das，他就上一个密码题啊我靠，八个小时，上了三波题，就开局一个密码，还是没写过的ECDSA加密，写不出来就很尴尬也很痛苦
<br>
<h2>题目</h2>
<h3>task</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from ecdsa.ecdsa import *
</span></span><span class="line"><span class="cl">from Crypto.Util.number import *
</span></span><span class="line"><span class="cl">import hashlib
</span></span><span class="line"><span class="cl">import gmpy2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def inverse_mod(a, m):
</span></span><span class="line"><span class="cl">    if a == 0:
</span></span><span class="line"><span class="cl">        return 0
</span></span><span class="line"><span class="cl">    return gmpy2.powmod(a, -1, m)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def bit_length(x):
</span></span><span class="line"><span class="cl">    return x.bit_length()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def get_malicious_key():
</span></span><span class="line"><span class="cl">    a = 751818   
</span></span><span class="line"><span class="cl">    b = 1155982
</span></span><span class="line"><span class="cl">    w = 908970521
</span></span><span class="line"><span class="cl">    X = 20391992
</span></span><span class="line"><span class="cl">    return a, b, w, X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class RSZeroError(RuntimeError):
</span></span><span class="line"><span class="cl">    pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class InvalidPointError(RuntimeError):
</span></span><span class="line"><span class="cl">    pass
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Signature(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;ECDSA signature.&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def __init__(self, r, s):
</span></span><span class="line"><span class="cl">        self.r = r
</span></span><span class="line"><span class="cl">        self.s = s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Public_key(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;Public key for ECDSA.&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def __init__(self, generator, point, verify=True):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        self.curve = generator.curve()
</span></span><span class="line"><span class="cl">        self.generator = generator
</span></span><span class="line"><span class="cl">        self.point = point
</span></span><span class="line"><span class="cl">        n = generator.order()
</span></span><span class="line"><span class="cl">        p = self.curve.p()
</span></span><span class="line"><span class="cl">        if not (0 &lt;= point.x() &lt; p) or not (0 &lt;= point.y() &lt; p):
</span></span><span class="line"><span class="cl">            raise InvalidPointError(
</span></span><span class="line"><span class="cl">                &#34;The public point has x or y out of range.&#34;
</span></span><span class="line"><span class="cl">            )
</span></span><span class="line"><span class="cl">        if verify and not self.curve.contains_point(point.x(), point.y()):
</span></span><span class="line"><span class="cl">            raise InvalidPointError(&#34;Point does not lay on the curve&#34;)
</span></span><span class="line"><span class="cl">        if not n:
</span></span><span class="line"><span class="cl">            raise InvalidPointError(&#34;Generator point must have order.&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if (
</span></span><span class="line"><span class="cl">            verify
</span></span><span class="line"><span class="cl">            and self.curve.cofactor() != 1
</span></span><span class="line"><span class="cl">            and not n * point == ellipticcurve.INFINITY
</span></span><span class="line"><span class="cl">        ):
</span></span><span class="line"><span class="cl">            raise InvalidPointError(&#34;Generator point order is bad.&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">class Private_key(object):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;Private key for ECDSA.&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def __init__(self, public_key, secret_multiplier):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        self.public_key = public_key
</span></span><span class="line"><span class="cl">        self.secret_multiplier = secret_multiplier
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def sign(self, hash, random_k):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        G = self.public_key.generator
</span></span><span class="line"><span class="cl">        n = G.order()# 获取该椭圆模数
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        k = random_k % n
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        p1 = k * G
</span></span><span class="line"><span class="cl">        r = p1.x() % n
</span></span><span class="line"><span class="cl">        if r == 0:
</span></span><span class="line"><span class="cl">            raise RSZeroError(&#34;amazingly unlucky random number r&#34;)
</span></span><span class="line"><span class="cl">        s = (
</span></span><span class="line"><span class="cl">            inverse_mod(k, n)
</span></span><span class="line"><span class="cl">            * (hash + (self.secret_multiplier * r) % n)
</span></span><span class="line"><span class="cl">        ) % n
</span></span><span class="line"><span class="cl">        if s == 0:
</span></span><span class="line"><span class="cl">            raise RSZeroError(&#34;amazingly unlucky random number s&#34;)
</span></span><span class="line"><span class="cl">        return Signature(r, s)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def malicious_sign(self,hash, random_k, a, b, w, X):
</span></span><span class="line"><span class="cl">        # t = random.randint(0,1)
</span></span><span class="line"><span class="cl">        t = 1
</span></span><span class="line"><span class="cl">        G = self.public_key.generator
</span></span><span class="line"><span class="cl">        Y = X * G
</span></span><span class="line"><span class="cl">        n = G.order()
</span></span><span class="line"><span class="cl">        k1 = random_k
</span></span><span class="line"><span class="cl">        z = (k1 - w * t) * G + (-a * k1 - b) * Y
</span></span><span class="line"><span class="cl">        zx = z.x() % n
</span></span><span class="line"><span class="cl">        k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)
</span></span><span class="line"><span class="cl">        #print(f&#39;k2 = {k2}&#39;)
</span></span><span class="line"><span class="cl">        p1 = k2 * G
</span></span><span class="line"><span class="cl">        r = p1.x() % n
</span></span><span class="line"><span class="cl">        if r == 0:
</span></span><span class="line"><span class="cl">            raise RSZeroError(&#34;amazingly unlucky random number r&#34;)
</span></span><span class="line"><span class="cl">        s = (
</span></span><span class="line"><span class="cl">                    inverse_mod(k2, n)
</span></span><span class="line"><span class="cl">                    * (hash + (self.secret_multiplier * r) % n)
</span></span><span class="line"><span class="cl">            ) % n
</span></span><span class="line"><span class="cl">        if s == 0:
</span></span><span class="line"><span class="cl">            raise RSZeroError(&#34;amazingly unlucky random number s&#34;)
</span></span><span class="line"><span class="cl">        return (Signature(r, s),k2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if __name__ == &#39;__main__&#39;:
</span></span><span class="line"><span class="cl">    a,b,w,X = get_malicious_key()
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    message1 = b&#39;It sounds as though you were lamenting,&#39;
</span></span><span class="line"><span class="cl">    message2 = b&#39;a butterfly cooing like a dove.&#39;
</span></span><span class="line"><span class="cl">    hash_message1 = int(hashlib.sha1(message1).hexdigest(), 16)
</span></span><span class="line"><span class="cl">    hash_message2 = int(hashlib.sha1(message2).hexdigest(), 16)
</span></span><span class="line"><span class="cl">    private = getRandomNBitInteger(50)
</span></span><span class="line"><span class="cl">    rand = getRandomNBitInteger(49)
</span></span><span class="line"><span class="cl">    public_key = Public_key(generator_192, generator_192 * private)
</span></span><span class="line"><span class="cl">    private_key = Private_key(public_key, private)
</span></span><span class="line"><span class="cl">    sig = private_key.sign(hash_message1, rand)
</span></span><span class="line"><span class="cl">    malicious_sig,k2 = private_key.malicious_sign(hash_message2, rand, a,b,w,X)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    print(a,b,w,X)
</span></span><span class="line"><span class="cl">    print(sig.r)
</span></span><span class="line"><span class="cl">    print(malicious_sig.r)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    &#39;&#39;&#39;
</span></span><span class="line"><span class="cl">    751818 1155982 908970521 20391992
</span></span><span class="line"><span class="cl">    sig.r=6052579169727414254054653383715281797417510994285530927615
</span></span><span class="line"><span class="cl">    malicious_sig.r=3839784391338849056467977882403235863760503590134852141664
</span></span><span class="line"><span class="cl">    &#39;&#39;&#39;
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    # flag为flag{uuid}格式
</span></span><span class="line"><span class="cl">    flag = b&#39;&#39;
</span></span><span class="line"><span class="cl">    m = bytes_to_long(flag)
</span></span><span class="line"><span class="cl">    p = k2
</span></span><span class="line"><span class="cl">    for i in range(99):
</span></span><span class="line"><span class="cl">        p = gmpy2.next_prime(p)
</span></span><span class="line"><span class="cl">    q = gmpy2.next_prime(p)
</span></span><span class="line"><span class="cl">    e = 65537
</span></span><span class="line"><span class="cl">    c = pow(m,e,p*q)
</span></span><span class="line"><span class="cl">    print(c)
</span></span><span class="line"><span class="cl">    # 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943
</span></span></code></pre></td></tr></table>
</div>
</div><p>写题的时候有一些地方被我改了一点点，应该可以看出来（）</p>
<h3>思路</h3>
刚拿到这个题目的时候第一想法是恢复k1再去恢复k2，第二遍读代码的时候看见 public_key = Public_key(generator_192, generator_192 * private),这就确定了这个曲线是curve_192，我又知道r，那我就可以直接去求出p，求p这里方法比较多，在网上找了个二次剩余的方法，求出p。
$$z = (k1 - w * t) * G + (-a * k1 - b) * Y $$<p>
</p>
$$化简成$$$$z=p1+(-w)*G+(-a)*X*p1+(-b)*X*G$$<p>那么这个题就出来了</p>
<p>exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import hashlib
</span></span><span class="line"><span class="cl">import gmpy2
</span></span><span class="line"><span class="cl">from Crypto.Util.number import *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">r1=6052579169727414254054653383715281797417510994285530927615
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#curve_192
</span></span><span class="line"><span class="cl">p=6277101735386680763835789423207666416083908700390324961279
</span></span><span class="line"><span class="cl">a=-3
</span></span><span class="line"><span class="cl">b=2455155546008943817740293915197451784769108058161191238065
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def convert_to_base(n, b):
</span></span><span class="line"><span class="cl">    if n &lt; 2:
</span></span><span class="line"><span class="cl">        return [n]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    temp = n
</span></span><span class="line"><span class="cl">    ans = []
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    while temp != 0:
</span></span><span class="line"><span class="cl">        ans = [temp % b] + ans
</span></span><span class="line"><span class="cl">        temp //= b
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return ans
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def cipolla(n, p):
</span></span><span class="line"><span class="cl">    n %= p
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if n == 0 or n == 1:
</span></span><span class="line"><span class="cl">        return [n, (p - n) % p]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    phi = p - 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if pow(n, phi // 2, p) != 1:
</span></span><span class="line"><span class="cl">        return []
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if p % 4 == 3:
</span></span><span class="line"><span class="cl">        ans = int(pow(n, (p + 1) // 4, p))
</span></span><span class="line"><span class="cl">        return [ans, (p - ans) % p]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    aa = 0
</span></span><span class="line"><span class="cl">    for i in range(1, p):
</span></span><span class="line"><span class="cl">        temp = pow(((i * i - n) % p), phi // 2, p)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if temp == phi:
</span></span><span class="line"><span class="cl">            aa = i
</span></span><span class="line"><span class="cl">            break
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    exponent = convert_to_base((p + 1) // 2, 2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    def cipolla_mult(ab, cd, w, p):
</span></span><span class="line"><span class="cl">        a, b = ab
</span></span><span class="line"><span class="cl">        c, d = cd
</span></span><span class="line"><span class="cl">        return (a * c + b * d * w) % p, (a * d + b * c) % p
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    x1 = (aa, 1)
</span></span><span class="line"><span class="cl">    x2 = cipolla_mult(x1, x1, aa * aa - n, p)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    for i in range(1, len(exponent)):
</span></span><span class="line"><span class="cl">        if exponent[i] == 0:
</span></span><span class="line"><span class="cl">            x2 = cipolla_mult(x2, x1, aa * aa - n, p)
</span></span><span class="line"><span class="cl">            x1 = cipolla_mult(x1, x1, aa * aa - n, p)
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            x1 = cipolla_mult(x1, x2, aa * aa - n, p)
</span></span><span class="line"><span class="cl">            x2 = cipolla_mult(x2, x2, aa * aa - n, p)
</span></span><span class="line"><span class="cl">    return [x1[0], (p - x1[0]) % p]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">y12=(r1**3+a*r1+b)%p
</span></span><span class="line"><span class="cl">print(cipolla(y12, p))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># sage
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">E = EllipticCurve(GF(p),[a,b])
</span></span><span class="line"><span class="cl">G = E(602046282375688656758213480587526111916698976636884684818,174050332293622031404857552280219410364023488927386650641) 
</span></span><span class="line"><span class="cl">p1 = E(6052579169727414254054653383715281797417510994285530927615, 5871535981004787479780408408652175440419840647034147933664) 
</span></span><span class="line"><span class="cl">a,b,w,X=751818 ,1155982, 908970521, 20391992
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">z=p1+(-w)*G+(-a)*X*p1+(-b)*X*G
</span></span><span class="line"><span class="cl">#z = (k1 - w * t) * G + (-a * k1 - b) * Y
</span></span><span class="line"><span class="cl">print(z)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">zx=2879837810202640866238433125146194557887945787271835955457
</span></span><span class="line"><span class="cl">k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)
</span></span><span class="line"><span class="cl">print(k2)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">p = k2
</span></span><span class="line"><span class="cl">for i in range(99):
</span></span><span class="line"><span class="cl">    p = gmpy2.next_prime(p)
</span></span><span class="line"><span class="cl">q = gmpy2.next_prime(p)
</span></span><span class="line"><span class="cl">print(p,q)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">p=1370020847323284147745373471297398364094203631317
</span></span><span class="line"><span class="cl">q=1370020847323284147745373471297398364094203631323
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">phi=(p-1)*(q-1)
</span></span><span class="line"><span class="cl">d=inverse(65537, phi)
</span></span><span class="line"><span class="cl">n=p*q
</span></span><span class="line"><span class="cl">c=1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">for i in range(2**16):
</span></span><span class="line"><span class="cl">    if b&#39;flag&#39; in long_to_bytes(pow(c,d, p*q)+n*i):
</span></span><span class="line"><span class="cl">        print(long_to_bytes(pow(c,d, p*q)+n*i))
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个方法绕过了k1直接去求k2
<br>
还有一个求k1的方法，貌似更简单，用大步小步算法去求解
exp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">from ecdsa.ecdsa import *
</span></span><span class="line"><span class="cl">import libnum 
</span></span><span class="line"><span class="cl">import re
</span></span><span class="line"><span class="cl">import gmpy2
</span></span><span class="line"><span class="cl">from Crypto.Util.number import *
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def BSGS(G, P, x1, x2):
</span></span><span class="line"><span class="cl">    m = ceil(sqrt(x2 - x1))
</span></span><span class="line"><span class="cl">    baby_steps = {}
</span></span><span class="line"><span class="cl">    current_step = G
</span></span><span class="line"><span class="cl">    for j in trange(m):
</span></span><span class="line"><span class="cl">        k_j = x1 + j
</span></span><span class="line"><span class="cl">        baby_steps[current_step] = k_j
</span></span><span class="line"><span class="cl">        current_step += G
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    mP = m * G
</span></span><span class="line"><span class="cl">    S = P
</span></span><span class="line"><span class="cl">    for i in trange(m):
</span></span><span class="line"><span class="cl">        if S in baby_steps:
</span></span><span class="line"><span class="cl">            return baby_steps[S] + i * m
</span></span><span class="line"><span class="cl">        S -= mP 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return None
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># BSGS(G, P, round(2**48.9), round(2**49))
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">_p = 6277101735386680763835789423207666416083908700390324961279
</span></span><span class="line"><span class="cl">def remove_whitespace(text):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;Removes all whitespace from passed in string&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    return re.sub(r&#34;\s+&#34;, &#34;&#34;, text, flags=re.UNICODE)
</span></span><span class="line"><span class="cl">_b = int(
</span></span><span class="line"><span class="cl">    remove_whitespace(
</span></span><span class="line"><span class="cl">        &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    64210519 E59C80E7 0FA7E9AB 72243049 FEB8DEEC C146B9B1&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    ),
</span></span><span class="line"><span class="cl">    16,
</span></span><span class="line"><span class="cl">)
</span></span><span class="line"><span class="cl">E = EllipticCurve(GF(_p),[-3, _b])
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">G = generator_192
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">r1 = 6052579169727414254054653383715281797417510994285530927615
</span></span><span class="line"><span class="cl">a = -3
</span></span><span class="line"><span class="cl">Py = r1^3 + a * r1 + _b
</span></span><span class="line"><span class="cl">Py = sqrt(Mod(Py, _p))
</span></span><span class="line"><span class="cl">P = E(r1,Py)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># k1 = optimized_bsgs_in_range(G,P,)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">c = 1294716523385880392710224476578009870292343123062352402869702505110652244504101007338338248714943
</span></span><span class="line"><span class="cl">a = 751818
</span></span><span class="line"><span class="cl">b = 1155982
</span></span><span class="line"><span class="cl">w = 908970521
</span></span><span class="line"><span class="cl">X = 20391992
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">k1 = 432179965122662
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">t = 1
</span></span><span class="line"><span class="cl">Y = X * G
</span></span><span class="line"><span class="cl">n = G.order()
</span></span><span class="line"><span class="cl">z = (k1 - w * t) * G + (-a * k1 - b) * Y
</span></span><span class="line"><span class="cl">zx = z.x() % n
</span></span><span class="line"><span class="cl">k2 = int(hashlib.sha1(str(zx).encode()).hexdigest(), 16)
</span></span><span class="line"><span class="cl">p = k2
</span></span><span class="line"><span class="cl">print(P.x())
</span></span><span class="line"><span class="cl">print(P.y())
</span></span><span class="line"><span class="cl">print(type(P))
</span></span><span class="line"><span class="cl">for i in range(99):
</span></span><span class="line"><span class="cl">    p = gmpy2.next_prime(p)
</span></span><span class="line"><span class="cl">q = gmpy2.next_prime(p)
</span></span><span class="line"><span class="cl">e = 65537
</span></span><span class="line"><span class="cl">d = libnum.invmod(e,(p-1)*(q-1))
</span></span><span class="line"><span class="cl">m = pow(c,d,p*q)
</span></span><span class="line"><span class="cl">for i in range(2 ** 16):
</span></span><span class="line"><span class="cl">    m += p*q
</span></span><span class="line"><span class="cl">    flag = long_to_bytes(int(m))
</span></span><span class="line"><span class="cl">    if b&#34;flag&#34; in flag:
</span></span><span class="line"><span class="cl">        print(i)
</span></span><span class="line"><span class="cl">        print(flag)
</span></span><span class="line"><span class="cl">        break
</span></span></code></pre></td></tr></table>
</div>
</div><h2>总结</h2>
还是太菜了，还得练，害，有些东西没有接触过，就导致看代码如懂，写题很烦躁，继续努力加油吧！</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-12-12</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" data-title="巅峰极客2024_crypto" data-hashtags="crypto"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" data-hashtag="crypto"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" data-title="巅峰极客2024_crypto"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" data-title="巅峰极客2024_crypto"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://www.zhuangsanmeng.xyz/%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22024crypto/" data-title="巅峰极客2024_crypto"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/crypto/">Crypto</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E5%BC%BA%E7%BD%91%E6%9D%AF2024_crypto/" class="prev" rel="prev" title="强网杯2024_crypto"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>强网杯2024_crypto</a>
            <a href="/%E5%9B%BD%E5%9F%8E%E6%9D%AF2024_crypto/" class="next" rel="next" title="国城杯2024_crypto">国城杯2024_crypto<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src=''></script>

    <script type="text/javascript">
        new Valine({
            el: '#valine',
            appId: 'XiJ1G58psCdX6BgfE27O7IH9-MdYXbMMI',
            appKey: 'e9j5fWZui0l2YfNwupu7SDW2',
            notify: '',
            verify: '',
            avatar: 'mp',
            placeholder: '留下你的评论～',
            visitor: 'true'
        });
    </script></div></article></div>
            </main><footer class="footer">
    <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer"
                title="Hugo 0.147.1">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank"
                rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw"
                    aria-hidden="true"></i> LoveIt</a>
        </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a
                    href="/" target="_blank">Zsm</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br" />
            <span class="icp">豫ICP备2024048128号</span></div>
    
        
        <script async src=" //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js "></script>
    

    
        
            <section>
                
                    <span id="busuanzi_container_value_site_pv"><i class="far fa-eye fa-fw"></i>
                        
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                

                
                    &nbsp;|&nbsp;              
                

                
                    <span id="busuanzi_container_value_site_uv"><i class="fa fa-user"></i>
                        
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
            </section>
        

        
        
    

</div>
</footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
